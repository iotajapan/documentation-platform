{"path":"docs/iot/0.1/cryptocore/iota-projects/send-zero-value","templateID":1,"sharedPropsHashes":{},"localProps":{"markdown":"# Send a zero-value transaction with the CryptoCore\n\n**In this guide, you create a bash script that take a user's input and attaches a zero-value transaction to the Tangle, using the CryptoCore UART API.**\n\nThis guide walks you through the process of writing the following scripts:\n\n- **`create_tx.sh`:** Uses the CryptoCore to create a zero-value transaction\n- **`send-tx.js`:** Connects to a node and sends the transaction to it\n\n:::info:\nThese code samples are also hosted on [GitHub](https://github.com/iota-community/cryptocore-scripts).\n:::\n\n:::warning:\nFor your convenience, all sample code uses the default secret key and the default API key.\n\nIf you want to use the CryptoCore in a production environment, you should follow the instructions in the 'Securing the FPGA' section of the [manual](https://gitlab.com/iccfpga-rv/iccfpga-manual/-/blob/master/iccfpga.pdf).\n:::\n\n## Prerequisites\n\nTo complete this guide, you need to have completed the [CryptoCore getting started guide](../introduction/get-started.md).\n\nYou also need Node.js installed on the Raspberry Pi. See [this article](https://github.com/nodesource/distributions/blob/master/README.md#debinstall) and follow the Ubuntu installation instructions.\n\n## Packages\n\nTo complete this guide, you need to install the following Node.js packages:\n\n--------------------\n### npm\n```bash\nnpm install @iota/core @iota/transaction-converter serialport\n```\n---\n### Yarn\n```bash\nyarn add @iota/core @iota/transaction-converter serialport\n```\n--------------------\n\nYou will also need to install the following Linux package:\n\n```bash\nsudo apt-get install jq\n```\n\n## Step 1. Create a zero-value transaction on the CryptoCore\n\nIn this step, you write the `create_tx.sh` script that prompts the user for the parameters to use to call the `jsonDataTX` endpoint on the CryptoCore. Then you save the returned transaction trytes to a file that the `send-tx.js` script can read.\n\n1. Create a directory called `cryptocore-scripts/bash-scripts`\n\n    ```bash\n    cd ~/cryptocore-scripts\n    sudo mkdir bash-scripts\n    cd bash-scripts\n    ```\n\n2. Create a new file called `create_tx.sh`\n\n    ```bash\n    sudo nano create_tx.sh\n    ```\n\n3. Ask whether the user wants to create a transaction for the Devnet or the Mainnet, and store the answer in the `MWM` variable\n\n    ```bash\n    #!/bin/bash\n\n    read -p \"Are you sending this transaction to the Devnet or the Mainnet? \" MWM\n    ```\n\n4. Use a regular expression to check if the user's answer begins with an 'm' and set the [minimum weight magnitude](/docs/getting-started/0.1/network/minimum-weight-magnitude) (MWM) according to the outcome\n\n    ```bash\n    if [[ $MWM =~ ^[mM] ]]\n    then\n            echo \"Setting minimum weight magnitude to 14 for the Mainnet.\"\n            MWM=14\n    else\n            echo \"Setting minimum weight magnitude to 9 for the Devnet.\"\n            MWM=9\n    fi\n    ```\n\n    :::info:\n    The MWM is essential for the CryptoCore to generate a valid proof of work.\n    :::\n\n5. Ask whether the user wants to send the transaction to a particular address\n\n    ```bash\n    read -p \"Would you like to send this zero-value transaction to a particular address? \" answer\n\n    if [[ $answer =~ ^[yY] ]]\n    then\n        read -s \"Please enter the 81-tryte address: \" address\n        else\n            address=\"999999999999999999999999999999999999999999999999999999999999999999999999999999999\"\n    fi\n    ```\n\n    :::info:\n    If the user does not enter a word beginning with 'y', this code sets the address to all 9s.\n    :::\n\n6. Get two tip transaction hashes from the Tangle by executing the `get-branch-and-trunk.js` script\n\n    ```bash\n    # Execute the get-branch-and-trunk.js script to get two tip transactions\n    trunk_and_branch=$(node ../node-scripts/get-branch-and-trunk.js $MWM)\n    trunk=$(echo \"$trunk_and_branch\" | jq '.trunkTransaction'| tr -d '\"\\n' )\n    branch=$(echo \"$trunk_and_branch\" | jq '.branchTransaction'| tr -d '\"\\n' )\n    ```\n\n    :::info:\n    The `get-branch-and-trunk.js` file uses the [`getTransactionsToApprove()`](https://github.com/iotaledger/iota.js/tree/next/packages/core#module_core.getTransactionsToApprove) method to get two tip transaction from the Tangle.\n\n    You can find the code for this file on [GitHub](https://github.com/iota-community/cryptocore-scripts/blob/master/node-scripts/get-branch-and-trunk.js).\n    :::\n\n7. Create a variable in which to store the current Unix epoch in seconds\n\n    ```bash\n    timestamp=$(date +%s)\n    ```\n\n    This timestamp is used\n\n8. Create a [`jsonDataTX`](../references/api-reference.md#jsondatatx) API request, send it to the CryptoCore through a serial terminal, and save the result to a file\n\n    ```bash\n    # Make sure a directory exists in which you can save unfinished or pending transactions\n    dir=\"$( dirname $( readlink -f $0 ) )\"\n    saved_transaction_directory=\"$dir/../my-transactions\"\n\n    if [ ! -d $saved_transaction_directory ]; then\n        mkdir $saved_transaction_directory\n    fi\n\n    template='{\"command\":\"jsonDataTX\",\"trunkTransaction\":\"%s\",\"branchTransaction\":\"%s\",\"minWeightMagnitude\":%d,\"tag\":\"CRYPTOCORE99999999999999999\", \"address\":\"%s\", \"timestamp\":%s,\"data\": { \"message\": \"HELLO WORLD FROM CRYPTOCORE\" }}'\n\n    json_string=$(printf \"$template\" \"$trunk\" \"$branch\" $MWM \"$address\" $timestamp)\n\n    node ../node-scripts/serial.js \"$json_string\" | jq \".trytes[]\" | tr -d '\"\\n' > $saved_transaction_directory/zero_value_transaction.txt\n    ```\n\n    :::info:\n    The `serial.js` file uses the [SerialPort package](https://serialport.io/docs/guide-installation) to open a serial connection to the CryptoCore.\n\n    You can find the code for this file on [GitHub](https://github.com/iota-community/cryptocore-scripts/blob/master/node-scripts/serial.js).\n    :::\n\n9. Execute the `send-tx.js` script and pass it the user's chosen MWM\n\n    ```bash\n    echo \"Attaching the transaction to the Tangle\"\n\n    # Execute the send-tx.js script to attach the transaction to the Tangle\n    attached_trytes=$(node ../node-scripts/send-tx.js $MWM)\n\n    # Print the result of the send-tx.js script\n    echo \"$attached_trytes\"\n    ```\n\nNow you have a way to create a zero-value transaction and save the trytes to a file, you can write the `send-tx.js` script to attach the transaction to the Tangle.\n\n## Step 2. Attach the transaction to the Tangle\n\nIn this step, you use the Javascript client library to attach the saved transaction trytes to the Tangle of the user's chosen IOTA network.\n\n1. Create a directory called `cryptocore-scripts/node-scripts`\n\n    ```bash\n    cd ~\n    sudo mkdir cryptocore-scripts/node-scripts\n    cd cryptocore-scripts/node-scripts\n    ```\n\n2. Create a file called `send-tx.js`\n\n    ```bash\n    sudo nano send-tx.js\n    ```\n\n4. Use the first argument that was passed to the script to connect to a node on either the Devnet or the Mainnet\n\n    ```js \n    // This argument should be a minimum weight magnitude (14 or 9)\n    const network = process.argv[2];\n\n    // Define a node for each IOTA network\n    const nodes = {\n            devnet: 'https://nodes.devnet.iota.org:443',\n            mainnet: `https://nodes.iota.org:443`\n    }\n\n    // Connect to the correct IOTA network, depending on the user's\n    // selection in the CryptoCore script\n    if (network === '14') {\n            iota = Iota.composeAPI({\n            provider: nodes.mainnet\n            });\n    } else {\n            iota = Iota.composeAPI({\n            provider: nodes.devnet\n            });\n    }\n\n5. Read the transaction trytes from the file\n\n    ```js\n    // This argument should be the path to which you can save unfinished or pending transactions\n    const savedTransactionDirectory = process.argv[3];\n\n    // Check the file for transaction trytes\n    const data = fs.readFileSync(`${savedTransactionDirectory}/zero_value_transaction_trytes.txt`);\n    const match = data.toString().match(/[A-Z9,]*/g);\n    const trytes = [match[0]];\n\n    if (!trytes) {\n            console.log(\"No trytes found. Make sure that proof of work was done and check the following file :\");\n            console.log(`${savedTransactionTrytes}/zero_value_transaction.txt`);\n    }\n    ```\n6. Use the [`storeAndBroadcast()`](https://github.com/iotaledger/iota.js/tree/next/packages/core#corestoreandbroadcasttrytes-callback) method to send the transaction to the connected node, and print the attached transaction object to the console\n\n    ```js\n    iota.storeAndBroadcast(trytes)\n    .then(result => {\n            console.log(Transaction.asTransactionObject(result));\n    })\n    .catch(error => {\n            console.log(error)\n    });\n    ```\n\n:::success:\nYou have just written a command-line interface (CLI) program that uses the CryptoCore to create a zero-value transaction and attaches it to the Tangle.\n:::\n\n## Run the code\n\nTo get started, you need [Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git) installed on your device.\n\nIf you don't have a JavaScript development environment, or if this is your first time using the JavaScript client library, complete our [getting started guide](/docs/client-libraries/0.1/getting-started/js-quickstart).\n\nIn the command-line, do the following:\n\n1. Clone the repository and change into the `cryptocore-scripts/node-scripts` directory\n\n    ```bash\n    git clone https://github.com/iota-community/cryptocore-scripts\n    cd cryptocore-scripts/node-scripts\n    ```\n\n2. Install the packages\n\n    ```bash\n    sudo npm i\n    ```\n\n    You should see something like the following:\n\n    ```\n    npm notice created a lockfile as package-lock.json. You should commit this file.\n    added 128 packages from 68 contributors and audited 338 packages in 34.171s\n\n    2 packages are looking for funding\n    run `npm fund` for details\n\n    found 0 vulnerabilities\n    ```\n\n3. Run the `create_tx.sh` script and respond to the prompts\n\n    ```bash\n    cd ~/cryptocore-scripts/bash-scripts\n    ./create_tx.sh\n    ```\n\n4. Follow the prompts\n\nYou should see the transaction object that was sent to the node. For example:\n\n```js\n{\n  hash: 'YQNCKGIGOZJJJGMNMAVWKJGDJLQOXDTADIJTYU9HBIGKTDKUXHBMOBXVZYWAUWOSKKYUSUIDVPNZZ9999',\n  signatureMessageFragment: 'ODGAADTCGDGDPCVCTCGADBGARBOBVBVBYBEAFCYBACVBNBEAPBACYBWBEAMBACHCZBCCYBMBYBACOBGAQD99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999',\n  address: '999999999999999999999999999999999999999999999999999999999999999999999999999999999',\n  value: 0,\n  obsoleteTag: 'CWYPTOCORE99999999999999999',\n  timestamp: 1059930011,\n  currentIndex: 0,\n  lastIndex: 0,\n  bundle: 'DAIHSSITPKSZRVHDTVLXIBPYGKLGKZBRDZSGRFYGIBXTPCZFIL9JAJDEGABAUVCJNHWAUULGXRBDGNDIZ',\n  trunkTransaction: 'HEWJUPLE9GHUDOFGCARASDIUDMXDQSV99WBSJYIXWHVCMHFGIXRTTTHBIEJGUPHCQQQGEZMZPRSRA9999',\n  branchTransaction: 'HEWJUPLE9GHUDOFGCARASDIUDMXDQSV99WBSJYIXWHVCMHFGIXRTTTHBIEJGUPHCQQQGEZMZPRSRA9999',\n  tag: 'CRYPTOCORE99999999999999999',\n  attachmentTimestamp: 1581607894939,\n  attachmentTimestampLowerBound: 0,\n  attachmentTimestampUpperBound: 11,\n  nonce: 'ICCFPGA9B9999999UVNPNVVMMMM'\n}\n```\n\nYou can copy the `hash` field of your transaction object and paste it into a [Tangle explorer](https://utils.iota.org/).\n\nIf the Tangle explorer doesn't display your transaction after 5 minutes, the node may not have sent your transaction to its neighbors.\n\nTo resend your transaction, you can pass the transaction trytes in the `my-transactions/zero_value_transaction_trytes.txt` file to the [`storeAndBroadcast()`](https://github.com/iotaledger/iota.js/tree/next/packages/core#corestoreandbroadcasttrytes-callback) method in the JavaScript client library.\n\n## Next steps\n\nTry [creating a large bundle of zero-value transactions](../iota-projects/do-proof-of-work.md) and doing proof of work for all of them on the CryptoCore.\n\n\n","title":"ゼロトークントランザクションを送信する | IOTA プロジェクト | CryptoCore | IoT プロジェクト"}}
