{"path":"docs/iota-js/0.1/how-to-guides/create-and-manage-cda","templateID":1,"sharedPropsHashes":{},"localProps":{"markdown":"# Send and receive transactions\n\n**To send and receive transactions in an account, you must use conditional deposit addresses (CDA). CDAs are special addresses that allow you to specify the conditions in which they may be used in account withdrawals and deposits.**\n\nAccounts use CDAs to help reduce the [risks of withdrawing from spent addresses](/docs/iota-basics/0.1/concepts/addresses-and-signatures#address-reuse). When you request IOTA tokens from a someone, you can create a CDA that's active for a certain period of time. This way, you let the sender know that you intend to withdraw from that address only after that time. As a result, the sender can decide whether to make a deposit, depending on how much time is left on a CDA.\n\n:::info:\nCDAs can be used only in an account and not in the generic [client library methods](/docs/client-libraries/0.1/introduction/overview). As a result, both you and the sender must have an account to be able to use CDAs.\n:::\n\n## State of a CDA\n\nCDAs can be in either an active or expired state. The state of a CDA determines whether you can withdraw from it or deposit into it:\n\n**Active CDA:** You can deposit IOTA tokens into an active address. You can't withdraw tokens from an active address.\n\n**Expired CDA:** You can withdraw tokens from an expired address. You can't deposit tokens into an expired address.\n\n## Conditions of a CDA\n\nTo create a CDA, specify the following condition, which defines whether it's active or expired:\n\n* **timeoutAt (required):** The time at which the address expires\n\nAnd one of the following, recommended fields:\n\n* **multiUse (recommended):** A boolean that specifies if the address may be sent more than one deposit.\n* **expectedAmount (recommended):** The amount of IOTA tokens that the address is expected to contain. When the address contains this amount, it's considered expired. We highly recommend using this condition.\n\n:::info:\nYou can't specify the `expected_amount` and `multi_use` fields in the same CDA. Please refer to the [FAQ](../references/cda-faq.md) for more information.\n:::\n\n|  **Combination of fields** | **Withdrawal conditions**\n| :----------| :----------|\n|`timeoutAt` |The CDA can used in withdrawals as long as it contains IOTA tokens|\n|`timeoutAt` and `multiUse` (recommended) |The CDA can be used in withdrawals as soon as it expires, regardless of how many deposits were made to it. See the [CDA FAQ](../references/cda-faq.md) on when to use addresses with the `multiUse` field set. |\n|`timeoutAt` and `expectedAmount` (recommended) | The CDA can be used in withdrawals as soon as it contain the expected amount. See the [CDA FAQ](../references/cda-faq.md) on when to use addresses with the `multi_use` field set.|\n\n:::warning:Warning\nIf a CDA was created with only the `timeoutAt` field, it can be used in withdrawals as soon as it has a non-zero balance even if it hasn't expired. \n\nTo avoid withdrawing from a spent address, we recommend creating CDAs with either the `multiUse` field or with the `expectedAmount` field whenever possible.\n:::\n\n## Create a CDA\n\n1. Pass the CDA fields to the `generateCDA()` method\n\n    ```js\n    account.generateCDA({\n        timeoutAt: Math.floor(new Date('7-16-2186').getTime() / 1000), // Date in seconds\n        multiUse: true,\n        security: 2\n    })\n        .then(cda => {\n            // Do something with the CDA\n            console.log(JSON.stringify(cda, null, 1));\n        })\n        .catch(error => {\n            // Handle errors here\n            console.log(error);\n        })\n    ```\n\n:::info:\nIf you created an account with a `timeSource()` method, you can call that method in the `timeoutAt` field.\n:::\n\n## Deposit IOTA tokens into a CDA\n\n1. After making sure that the CDA is still active, use the `account.sendToCDA()` method to deposit IOTA tokens into it\n\n    ```js   \n    account.sendToCDA({\n        address: 'AT9GOVPQDDKAJ...ADFA9IRSV', // must include the checksum\n        multiUse: false,\n        timeoutAt: 6833278800,\n        expectedAmount: 10000000,\n        value: 10000000\n    })\n         .then((trytes) => {\n            console.log('Successfully prepared transaction trytes:', trytes)\n        })\n        .catch(err => {\n            // Handle errors here...\n        });\n\n    // Start attaching transactions to the Tangle\n    // The startAttaching routine will keep on attaching uncomfirmed transactions until they are confirmed\n    // The routine stops when there are no uncomfirmed bundles anymore, and resumes when you send another one\n    account.startAttaching({\n        depth: 3,\n        minWeightMagnitude: 9,\n        delay: 30 * 1000 // 30 second delay\n    });\n    \n    // Or stop attaching\n    account.stopAttaching();\n    ```\n\n2. **Optional:** To use a CDA as a magnet link, pass it to the `parseCDAMagnet()` method, then and pass the result to the`sendToCDA()` method\n\n    ```js\n     const magnetLink = 'iota://MBREWACWIPRFJRDYYHAAME…AMOIDZCYKW/?timeout_at=1548337187&multi_use=1&expected_amount=0'\n     const { address, timeoutAt, multiUse, expectedAmount } = parseCDAMagnet(\n        magnetLink\n    );\n\n    account.sendToCDA({\n        address,\n        timeoutAt,\n        multiUse,\n        expectedAmount,\n        value: 1 // Value to send to the CDA\n    })\n        .then((trytes) => {\n            console.log('Successfully prepared transaction trytes:', trytes)\n        })\n        .catch(err => {\n            // Handle errors here...\n        });\n\n    // Start attaching transactions to the Tangle\n    // The startAttaching routine will keep on attaching uncomfirmed transactions until they are confirmed\n    // The routine stops when there are no uncomfirmed bundles anymore, and resumes when you send another one\n    account.startAttaching({\n        depth: 3,\n        minWeightMagnitude : 9,\n        delay: 30 * 1000 // 30 second delay\n    });\n    \n    // Or stop attaching\n    account.stopAttaching();\n    ```\n\n## Distribute a CDA\n\nThe `generateCDA()` method returns a CDA object with the following fields. You can serialize a CDA into any format before distributing it to senders:\n\n```js\n{\n   address, // The last 9 trytes are the checksum\n   timeoutAt,\n   multiUse,\n   expectedAmount\n}\n```\n\n1. To serialize a CDA into a magnet link, use the `serializeCDAMagnet()` method in the `@iota/cda` module\n\n    ```js\n    const CDA = require('@iota/cda');\n    \n    const magnetLink = CDA.serializeCDAMagnet(cda);\n    // iota://MBREWACWIPRFJRDYYHAAME…AMOIDZCYKW/?timeout_at=1548337187&multi_use=1\n    ```\n","title":"Send and receive transactions | How-to Guides | IOTA JS"}}
