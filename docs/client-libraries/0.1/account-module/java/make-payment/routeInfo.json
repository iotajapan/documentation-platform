{"path":"docs/client-libraries/0.1/account-module/java/make-payment","templateID":1,"sharedPropsHashes":{},"localProps":{"markdown":"# Make payments to/from your account\n\n**To make payments, both the sender and the receiver need to have a conditional deposit address (CDA). The sender needs an expired CDA that contains IOTA tokens, and the receiver needs an active CDA to send tokens to.**\n\n## IOTA network\n\nIn this guide, we connect to a node on the [Devnet](/docs/getting-started/0.1/network/iota-networks#devnet).\n\n## Step 1. Create a conditional deposit address\n\n1. [Plan the conditions](../introduction/overview.md#advice-for-creating-cdas) you would like your conditional deposit address to have\n\n2. Define an expiration time for the CDA. This one expires tomorrow.\n\n    ```java\n    Date hours = new Date(System.currentTimeMillis() + 24000 * 60 * 60);\n\n    ```\n\n2. Create a new CDA with an expiration time and expected amount\n\n    ```java\n    Future<ConditionalDepositAddress> cda = account.newDepositAddress(hours, false, 1000).get();\n    ```\n\nIf you want senders to transfer IOTA tokens to your account, you need to send them your CDA.\n\nBecause CDAs are descriptive objects with the following fields, you can serialize them into any format before sending them:\n\n```js\n{\n   address, // The last 9 trytes are the checksum\n   timeout_at,\n   multi_use,\n   expected_amount\n}\n```\n\nFor example, you can serialize these fields to create a magnet link.\n\n### Optional: Serialize a CDA into a magnet link\n\n1. To serialize a CDA to a magnet link, do the following:\n\n    ```java\n    String magnet = DepositFactory.get().build(cda.get(), MagnetMethod.class);\n\n    System.out.println(magnet);\n    // iota://YWEQLREFJQORXXKKEBBBDKOPAXHXJRGVPBUTBJFSRPPYVWWYUWSBDJTIUBJVFREXEAUZWRICKH9VBSQE9KPNLTCLNC/?timeout_at=1554472983208&multi_use=false&expected_amount=1000\n    ```\n\n2. To deserialize the magnet link into a CDA, do the following\n\n    ```java\n     String magnet = \"iota://YWEQLREFJQORXXKKEBBBDKOPAXHXJRGVPBUTBJFSRPPYVWWYUWSBDJTIUBJVFREXEAUZWRICKH9VBSQE9KPNLTCLNC/?timeout_at=1554472983208&multi_use=false&expected_amount=1000\";\n    ConditionalDepositAddress cda = DepositFactory.get().parse(magnet, MagnetMethod.class);\n    ```\n\n## Step 2. Make a payment\n\n1. Copy and paste your address into the [Devnet faucet](https://faucet.devnet.iota.org), then wait for the tokens to be transferred to your address\n\n    :::info:\n    The last 9 characters of a CDA are the checksum, which is a hash of the address and all of its conditions.\n\n    Make sure to remove the checksum before requesting IOTA tokens from the Devnet faucet.\n    :::\n\n\n2. After making sure that the CDA is still active, send a deposit to it\n\n    ```java\n    Future<Bundle> bundle = account.send(\n            cda.getDepositAddress().getHashCheckSum(),\n            cda.getRequest().getExpectedAmount(),\n            Optional.of(\"Thanks for that pizza!\"), Optional.of(\"OMNOMNOM\"));\n    bundle.get();\n    ```\n\nYour account will reattach and promote your bundle until it's confirmed.\n\n### Optional: Combine your entire available balance into one CDA\n\nYou may want to keep the majority of your balance on as few CDAs as possible. This way, making payments is faster and requires fewer transactions. To do so, you can transfer you available balance to a new CDA.\n\n1. Create a CDA that has your account's total available balance as its expected amount\n\n    ```java\n\tDate hours = new Date(System.currentTimeMillis() + 10000 * 60 * 60);\n    ConditionalDepositAddress cda = account.newDepositAddress(hours, false, account.availableBalance()).get();\n    ```\n\n    :::info:\n    Available balance is the total balance of all expired CDAs, which is safe to withdraw.\n\n    Your account's total balance includes CDAs that are still active as well as expired, which is unsafe to withdraw.\n    :::\n\n2. Transfer your total available balance to the CDA\n\n    ```java\n    Future<Bundle> bundle = account.send(\n            address.getDepositAddress().getHashCheckSum(),\n            address.getRequest().getExpectedAmount(),\n            Optional.of(\"Sweep of all addresses\"),\n            Optional.of(\"IOTA9SWEEP\"));\n    bundle.get();\n    ```\n","title":"支払いを作成する | Java | アカウントモジュール | CLライブラリ"}}
