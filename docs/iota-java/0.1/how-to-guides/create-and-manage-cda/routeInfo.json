{"path":"docs/iota-java/0.1/how-to-guides/create-and-manage-cda","templateID":1,"sharedPropsHashes":{},"localProps":{"markdown":"# Send and receive transactions\n\n**To send and receive transactions in an account, you must use conditional deposit addresses (CDA). CDAs are special addresses that allow you to specify the conditions in which they may be used in account withdrawals and deposits.**\n\nAccounts use CDAs to help reduce the [risks of withdrawing from spent addresses](/docs/iota-basics/0.1/concepts/addresses-and-signatures#address-reuse). When you request IOTA tokens from a someone, you can create a CDA that's active for a certain period of time. This way, you let the sender know that you intend to withdraw from that address only after that time. As a result, the sender can decide whether to make a deposit, depending on how much time is left on a CDA.\n\n:::info:\nCDAs can be used only in an account and not in the generic [client library methods](/docs/client-libraries/0.1/introduction/overview). As a result, both you and the sender must have an account to be able to use CDAs.\n:::\n\n## State of a CDA\n\nCDAs can be in either an active or expired state. The state of a CDA determines whether you can withdraw from it or deposit into it:\n\n**Active CDA:** You can deposit IOTA tokens into an active address. You can't withdraw tokens from an active address.\n\n**Expired CDA:** You can withdraw tokens from an expired address. You can't deposit tokens into an expired address.\n\n## Conditions of a CDA\n\nTo create a CDA, specify the following condition, which defines whether it's active or expired:\n\n* **timeout_at (required):** The time at which the address expires\n\nAnd one of the following, recommended fields:\n\n* **multi_use (recommended):** A boolean that specifies if the address may be sent more than one deposit.\n* **expected_amount (recommended):** The amount of IOTA tokens that the address is expected to contain. When the address contains this amount, it's considered expired. We highly recommend using this condition.\n\n:::info:\nYou can't specify the `expected_amount` and `multi_use` fields in the same CDA. Please refer to the [FAQ](../references/cda-faq.md) for more information.\n:::\n\n|  **Combination of fields** | **Withdrawal conditions**\n| :----------| :----------|\n|`timeout_at` |The CDA can used in withdrawals as long as it contains IOTA tokens|\n|`timeout_at` and `multi_use` (recommended) |The CDA can be used in withdrawals as soon as it expires, regardless of how many deposits were made to it. See the [CDA FAQ](../references/cda-faq.md) on when to use addresses with the `multi_use` field set. |\n|`timeout_at` and `expected_amount` (recommended) | The CDA can be used in withdrawals as soon as it contain the expected amount. See the [CDA FAQ](../references/cda-faq.md) on when to use addresses with the `multi_use` field set.|\n\n:::warning:Warning\nIf a CDA was created with only the `timeout_at` field, it can be used in withdrawals as soon as it has a non-zero balance even if it hasn't expired. \n\nTo avoid withdrawing from a spent address, we recommend creating CDAs with either the `multi_use` field or with the `expected_amount` field whenever possible.\n:::\n\n## Create a CDA\n\n1. Define an expiration time for the CDA\n  \n    ```java\n    // In this case, after 72 hours\n    Date hour = new Date(System.currentTimeMillis() + 72000 * 60 * 60);\n    \n    ```\n\n2. Create a new CDA with an expiration time and expected amount\n\n    ```java\n    Future<ConditionalDepositAddress> cda = account.newDepositAddress(hour, false, account.usableBalance()).get();\n    ```\n\n## Deposit IOTA tokens into a CDA\n\n1. When a CDA contains an expected amount, you can deposit that amount into it by passing the object to the `account.send()` method.\n\n    ```java\n    String magnet = \"iota://YWEQLREFJQORXXKKEBBBDKOPAXHXJRGVPBUTBJFSRPPYVWWYUWSBDJTIUBJVFREXEAUZWRICKH9VBSQE9KPNLTCLNC/?timeout_at=1554472983208&multi_use=false&expected_amount=1000\";\n    ConditionalDepositAddress cda = DepositFactory.get().parse(magnet, MagnetMethod.class);\n    Future<Bundle> bundle = account.send(\n            cda.getDepositAddress().getHashCheckSum(),\n            cda.getRequest().getExpectedAmount(),\n            Optional.of(\"Thanks for that pizza!\"), Optional.of(\"OMNOMNOM\"));\n    bundle.get();\n    ```\n\n:::info:\nIf you're testing your account on the Devnet and you don't have enough balance, use the [Devnet faucet](https://faucet.devnet.iota.org/) to request Devnet tokens.\n:::\n\n## Deposit your entire account balance into one CDA\n\n1. Create a CDA that has your account's total usable balance as its expected amount\n\n    ```java\n\tDate n = new Date(System.currentTimeMillis() + 10000 * 60 * 60);\n    ConditionalDepositAddress address = account.newDepositAddress(n, false, account.usableBalance()).get();\n    ```\n\n    :::info:\n    Usable balance is the total balance of all expired CDAs.\n    :::\n\n2. Deposit your total usable balance into the CDA by passing the object to the `account.send()` method\n\n    ```java\n    Future<Bundle> bundle = account.send(\n            address.getDepositAddress().getHashCheckSum(), \n            address.getRequest().getExpectedAmount(), \n            Optional.of(\"Sweep of all addresses\"),\n            Optional.of(\"IOTA9SWEEP\"));\n    bundle.get();\n    ```\n\n## Distribute a CDA\n\nBecause CDAs are descriptive objects, you can serialize them into any format and distribute them. For example, you can create a magnet-link for a CDA, with the `timeout_at`, `multi_use`, and `expected_amount` parameters.\n\n```\niota://MBREWACWIPRFJRDYYHAAMEâ€¦AMOIDZCYKW/?timeout_at=1548337187&multi_use=false&expected_amount=1000\n```\n\n1. To serialize a CDA to a magnet link, do the following:\n\n    ```java\n    String magnet = DepositFactory.get().build(cda.get(), MagnetMethod.class);\n    \n    System.out.println(magnet);\n    // iota://YWEQLREFJQORXXKKEBBBDKOPAXHXJRGVPBUTBJFSRPPYVWWYUWSBDJTIUBJVFREXEAUZWRICKH9VBSQE9KPNLTCLNC/?timeout_at=1554472983208&multi_use=false&expected_amount=1000\n    ```","title":"Send and receive transactions | How-to Guides | IOTA Java"}}
